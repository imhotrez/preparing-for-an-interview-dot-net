#### Что изучить:

- Архитектура реляционных баз данных.
- Основные концепции PostgreSQL (таблицы, схемы, роли, транзакции).
- Типы данных PostgreSQL (integer, numeric, text, JSON, arrays, etc.).
- DDL (Data Definition Language): создание, изменение, удаление таблиц.
- DML (Data Manipulation Language): вставка, обновление, удаление, выборка данных.
- Механизмы блокировок (locks) и транзакции в PostgreSQL.
- Основы ACID.

#### Промпт:

_«Представь, что ты — опытный наставник по PostgreSQL. Составь подробное руководство, которое поможет начинающему разработчику освоить базовые концепции PostgreSQL: 
- Архитектура реляционных баз данных.
- Основные концепции PostgreSQL (таблицы, схемы, роли, транзакции).
- Типы данных PostgreSQL (integer, numeric, text, JSON, arrays, etc.).
- DDL (Data Definition Language): создание, изменение, удаление таблиц.
- DML (Data Manipulation Language): вставка, обновление, удаление, выборка данных.
- Механизмы блокировок (locks) и транзакции в PostgreSQL.
- Основы ACID. 
Включи примеры кода и объясни, как они работают.»_

### Руководство по основам PostgreSQL для начинающих разработчиков

Это руководство объясняет ключевые концепции PostgreSQL, основываясь на практических примерах. Оно охватывает архитектуру, работу с таблицами, транзакциями, типами данных и другие фундаментальные аспекты.

---

## **1. Архитектура реляционных баз данных**

Реляционные базы данных хранят данные в виде таблиц (relations), где каждая таблица имеет строки (записи) и столбцы (атрибуты). PostgreSQL является объектно-реляционной СУБД и включает следующие ключевые элементы:

- **Клиент-серверная архитектура:** база данных запускается как серверный процесс, к которому подключаются клиенты.
- **Таблицы:** основная структура хранения данных.
- **Схемы:** логическое разделение объектов (таблиц, функций) внутри базы данных.
- **Транзакции:** механизм для обеспечения целостности данных.
- **Журнал транзакций (WAL):** отвечает за восстановление данных после сбоев.

---

## **2. Основные концепции PostgreSQL**

### Таблицы и схемы

- **Таблицы:** хранят данные в строках и столбцах.
- **Схемы:** используются для группировки объектов. По умолчанию PostgreSQL использует схему `public`.

#### Пример:

```sql
-- Создаем схему
CREATE SCHEMA my_schema;

-- Создаем таблицу в схеме
CREATE TABLE my_schema.users (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL
);
```

### Роли

Роли управляют доступом к объектам базы данных.

#### Пример:

```sql
-- Создаем роль
CREATE ROLE developer WITH LOGIN PASSWORD 'securepassword';

-- Даем роль пользователю
GRANT developer TO current_user;
```

---

## **3. Типы данных PostgreSQL**

PostgreSQL поддерживает множество типов данных:

- **Числовые:** `INTEGER`, `NUMERIC`, `SERIAL`.
- **Текстовые:** `TEXT`, `VARCHAR`, `CHAR`.
- **Дата и время:** `DATE`, `TIMESTAMP`.
- **Логические:** `BOOLEAN`.
- **JSON:** `JSON`, `JSONB`.
- **Массивы:** массив любого поддерживаемого типа данных.

#### Пример:

```sql
-- Пример таблицы с разными типами данных
CREATE TABLE examples (
    id SERIAL PRIMARY KEY,
    title TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    tags TEXT[],
    metadata JSONB
);

-- Вставляем данные
INSERT INTO examples (title, tags, metadata)
VALUES (
    'Пример', 
    ARRAY['PostgreSQL', 'JSON', 'Arrays'], 
    '{"author": "Admin", "views": 100}'
);
```

---

## **4. Data Definition Language (DDL)**

DDL используется для управления структурами данных.

#### Пример: Создание таблицы

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    price NUMERIC(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### Пример: Изменение таблицы

```sql
-- Добавляем колонку
ALTER TABLE products ADD COLUMN stock INTEGER DEFAULT 0;

-- Удаляем колонку
ALTER TABLE products DROP COLUMN stock;
```

#### Пример: Удаление таблицы

```sql
DROP TABLE products;
```

---

## **5. Data Manipulation Language (DML)**

DML используется для управления данными: вставка, обновление, удаление и выборка.

#### Пример: Вставка данных

```sql
INSERT INTO products (name, price) 
VALUES ('Product A', 19.99), ('Product B', 29.99);
```

#### Пример: Обновление данных

```sql
UPDATE products
SET price = price * 1.10
WHERE name = 'Product A';
```

#### Пример: Удаление данных

```sql
DELETE FROM products
WHERE price > 25;
```

#### Пример: Выборка данных

```sql
SELECT * FROM products
WHERE price < 30
ORDER BY created_at DESC;
```

---

## **6. Механизмы блокировок (Locks) и транзакции**

### Транзакции

Транзакции обеспечивают согласованность данных. PostgreSQL поддерживает ACID (Atomicity, Consistency, Isolation, Durability).

#### Пример: Транзакция

```sql
BEGIN; -- Начало транзакции

INSERT INTO products (name, price) VALUES ('Product C', 39.99);

-- Ручной откат
ROLLBACK; -- Отменяет все изменения

-- Новая транзакция
BEGIN;
INSERT INTO products (name, price) VALUES ('Product D', 49.99);

COMMIT; -- Применяет изменения
```

### Блокировки

PostgreSQL автоматически управляет блокировками для обеспечения целостности данных, но также позволяет использовать ручные блокировки.

#### Пример: Ручная блокировка

```sql
LOCK TABLE products IN SHARE MODE;
```

---

## **7. Основы ACID**

ACID — это свойства транзакций:

1. **Атомарность:** транзакция либо выполняется полностью, либо не выполняется вовсе.
2. **Согласованность:** данные остаются в согласованном состоянии.
3. **Изоляция:** параллельные транзакции не конфликтуют.
4. **Долговечность:** успешные транзакции сохраняются даже в случае сбоя.

#### Пример:

```sql
BEGIN;

-- Атомарность: либо вставка пройдет для обеих строк, либо ни одной
INSERT INTO products (name, price) VALUES ('Product E', 59.99), ('Product F', 69.99);

COMMIT;
```

---

## **Резюме**

Эти основы позволяют вам уверенно работать с PostgreSQL:

- Используйте DDL для создания и изменения структуры данных.
- Освойте типы данных PostgreSQL для гибкости в работе с таблицами.
- Работайте с транзакциями и блокировками для обеспечения согласованности данных.
- Постоянно тестируйте запросы и анализируйте их производительность.

Для углубления знаний, перейдите к оптимизации запросов, индексации и масштабированию базы данных.
